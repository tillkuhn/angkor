<!-- loosely based on ng generate @angular/material:material-nav --name=nav -->
<!-- this is the full width part below the top menu [style.marginTop.px]="(isHandset$ | async) ? 56 : 0"-->
<mat-sidenav-container class="sidenav-container">


  <!-- lefthandside menu, can fly in  fixedTopGap="56" -->
  <!-- CHECK https://stackoverflow.com/questions/53512602/closing-side-nav-on-clicking-router-link-for-small-devices
       https://stackblitz.com/edit/angular-close-side-nav-on-button-click?file=app%2Fsidenav-responsive-example.html -->
  <mat-sidenav #drawer [attr.role]="(isHandset$ | async) ? 'dialog' : 'navigation'"
               [mode]="(isHandset$ | async) ? 'over' : 'side'"
               [opened]="(isHandset$ | async) === false"
               class="sidenav"
               fixedInViewport>
    <!--
    <mat-sidenav #drawer [mode]="mobileQuery.matches ? 'over' : 'side'"
                 [fixedInViewport]="mobileQuery.matches" fixedTopGap="56">     -->
    <mat-toolbar>ðŸ¥£ Today's Menu</mat-toolbar>
    <mat-divider></mat-divider>
    <mat-nav-list>
      <a (click)="closeIfHandset(drawer)" [routerLink]="['/home']" mat-list-item>
        <mat-icon matListIcon>home</mat-icon>
        HomeZone</a>
      <a (click)="closeIfHandset(drawer)" [routerLink]="['/places']" mat-list-item>
        <mat-icon matListIcon>place</mat-icon>
        Places 2 Go</a>
      <a (click)="closeIfHandset(drawer)" [routerLink]="['/map']" mat-list-item>
        <mat-icon matListIcon>language</mat-icon>
        WorldWideMap</a>
      <a (click)="closeIfHandset(drawer)" [routerLink]="['/dishes']" mat-list-item>
        <mat-icon matListIcon>food_bank</mat-icon>
        Wish a Dish</a>
      <a (click)="closeIfHandset(drawer)" [routerLink]="['/notes']" mat-list-item>
        <mat-icon matListIcon>emoji_objects</mat-icon>
        MerksteWas?</a>
      <mat-divider></mat-divider>
      <ng-container *ngIf="authService.isAdmin">
        <a (click)="closeIfHandset(drawer)" [routerLink]="['/area-tree']" mat-list-item>
          <mat-icon matListIcon>local_florist</mat-icon>
          Area Tree</a>
        <a (click)="closeIfHandset(drawer)" [routerLink]="['/admin/metrics']" mat-list-item>
          <mat-icon matListIcon>admin_panel_settings</mat-icon>
          Admin</a>
      </ng-container>
      <a href="/angkor-docs" mat-list-item target="_docs">
        <mat-icon matListIcon>text_snippet</mat-icon>
        DevGuide</a>
      <a [href]="imprintUrl" mat-list-item target="_imprint">
        <mat-icon matListIcon>gavel</mat-icon>
        Imprint</a>
    </mat-nav-list>
  </mat-sidenav>

  <!-- this is the main page w/o sidenav (top menu plus router content) -->
  <mat-sidenav-content class="app-background">
    <!-- toolbar is always on top -->

    <mat-toolbar color="primary">
      <button (click)="drawer.toggle()" aria-label="Toggle sidenav" mat-icon-button type="button">
        <mat-icon aria-label="Side nav toggle icon">menu</mat-icon>
      </button>
      <a aria-label="Home"  routerLink="home" title="Go Home" class="title">
        <span>{{title}}</span>&nbsp; <!-- welcome to TiMaFe on Air -->
      </a>

      <!-- ng book p 360 subscribe only once, use template var-->
      <ng-container *ngIf="authService.isAuthenticated$ | async as authenticated; else unauthenticated">

        <a aria-label="Account" mat-icon-button routerLink="my-profile"  title="Open Account Info">
          <mat-icon aria-label="Account">face_outline</mat-icon>
        </a>
        <span *ngIf="authService.currentUser" class="smaller">{{authService.currentUser.name}}</span>&nbsp;
        <button (click)="authService.logout()" aria-label="Logout" color="accent" mat-mini-fab>
          <mat-icon aria-label="Login">logout_outline</mat-icon>
        </button>
      </ng-container>

      <!-- not logged in yet? Show Login button-->
      <ng-template #unauthenticated>
        <button (click)="authService.login()" aria-label="Login" color="accent" mat-mini-fab title="Login to {{title}}">
          <mat-icon aria-label="Login">login_outline</mat-icon>
        </button>
      </ng-template>

    </mat-toolbar>

    <!-- global progress bar -->
    <div style="height: 4px">
      <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>
    </div>

    <!-- Add Main Content  -->
    <router-outlet></router-outlet>



  </mat-sidenav-content>
</mat-sidenav-container>
