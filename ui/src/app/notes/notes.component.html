<div class="app-flex">
  <mat-card class="app-card">
    <form (ngSubmit)="onFormSubmit()" [formGroup]="formData">

      <mat-form-field appearance="fill" class="app-full-width">
        <textarea #autosize="cdkTextareaAutosize" [errorStateMatcher]="matcher" cdkAutosizeMaxRows="5"
                  cdkAutosizeMinRows="1"
                  cdkTextareaAutosize
                  formControlName="summary"
                  matInput
                  placeholder="Summary"></textarea>
        <mat-error>
          <span
            *ngIf="!formData.get('summary').valid && formData.get('summary').touched">Summary is mandatory</span>
        </mat-error>
      </mat-form-field>

      <!-- Due Date -->
      <mat-form-field>
        <!--<mat-label>Choose a date</mat-label>-->
        <input [matDatepicker]="picker" formControlName="dueDate" matInput placeholder="Due Date">
        <mat-datepicker-toggle [for]="picker" matSuffix></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <!-- TAGS -->
      <mat-form-field class="app-full-width">
        <mat-chip-list #chipList>
          <mat-chip (removed)="remove(i)"
                    *ngFor="let tag of formData.get('tags').value; let i = index;"
                    [removable]="removable"
                    [selectable]="selectable" color="accent">
            {{tag}}
            <mat-icon *ngIf="removable" matChipRemove>cancel</mat-icon>
          </mat-chip>
          <input (matChipInputTokenEnd)="add($event)"
                 [matChipInputAddOnBlur]="addOnBlur"
                 [matChipInputFor]="chipList"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 matInput
                 placeholder="Add Tags ..."/>
        </mat-chip-list>
      </mat-form-field>
      <!-- END TAGS -->

      <div class="app-button-row">
        <button [disabled]="!formData.valid" color="primary" mat-flat-button type="submit">
          <mat-icon>save</mat-icon>
          Add new Quicknote
        </button>
      </div>
    </form>

    <!-- Existing Notes -->
    <!-- #mytable is a template variable which we will use to refresh table data by calling -->
    <table [dataSource]="data" class="example-table" mat-table matSort matSortActive="summary" matSortDirection="asc"
           matSortDisableClear>

      <ng-container matColumnDef="summary">
        <th *matHeaderCellDef mat-header-cell>Summary</th>
        <!-- color only works when selected is true -->
        <td *matCellDef="let row" mat-cell>
          <mat-chip *ngFor="let tag of row.tags" class="mat-chip-tag" color="primary" selected="true">{{tag}}</mat-chip>
          {{row.summary}}&nbsp;&nbsp;
        </td>
      </ng-container>

      <!--
      <ng-container matColumnDef="tags">
        <th mat-header-cell *matHeaderCellDef>Summary</th>
        <td mat-cell *matCellDef="let row">
        </td>
      </ng-container>
      -->

      <ng-container matColumnDef="status">
        <th *matHeaderCellDef mat-header-cell>Status</th>
        <td *matCellDef="let row" mat-cell>
          <mat-icon matTooltip="hase">{{getNoteStatus(row.status).icon}}</mat-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="createdAt">
        <th *matHeaderCellDef mat-header-cell>Created</th>
        <td *matCellDef="let row" mat-cell>{{row.createdAt | amTimeAgo }}</td>
      </ng-container>

      <ng-container matColumnDef="dueDate">
        <th *matHeaderCellDef mat-header-cell>Due</th>
        <td *matCellDef="let row" mat-cell>{{row.dueDate ? (row.dueDate | amTimeAgo) : 'never'}}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th *matHeaderCellDef mat-header-cell> Action</th>
        <td *matCellDef="let row;  let j = index;" mat-cell>
          <button (click)="deleteRow(row,j)" *ngIf="authService.canDelete" color="warn" mat-icon-button>
            <mat-icon>delete_forever</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
      <tr *matRowDef="let row; columns: displayedColumns;" mat-row></tr>
    </table>
  </mat-card>

</div>
