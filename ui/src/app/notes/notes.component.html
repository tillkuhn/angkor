<div class="mat-elevation-z4">

  <mat-card class="example-card">
    <form [formGroup]="formData" (ngSubmit)="onFormSubmit()">

      <mat-form-field class="app-full-width" appearance="fill">
        <textarea matInput placeholder="Summary" formControlName="summary" [errorStateMatcher]="matcher"
                  cdkTextareaAutosize
                  #autosize="cdkTextareaAutosize"
                  cdkAutosizeMinRows="1"
                  cdkAutosizeMaxRows="5"></textarea>
        <mat-error>
          <span
            *ngIf="!formData.get('summary').valid && formData.get('summary').touched">Summary is mandatory</span>
        </mat-error>
      </mat-form-field>

      <!-- Due Date -->
      <mat-form-field>
        <!--<mat-label>Choose a date</mat-label>-->
        <input matInput [matDatepicker]="picker" placeholder="Due Date" formControlName="dueDate">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <!-- TAGS -->
      <mat-form-field class="app-full-width">
        <mat-chip-list #chipList>
          <mat-chip *ngFor="let tag of formData.get('tags').value; let i = index;"
                    [selectable]="selectable"
                    [removable]="removable"
                    (removed)="remove(i)" color="accent">
            {{tag}}
            <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
          </mat-chip>
          <input matInput
            placeholder="Add Tags ..."
            [matChipInputFor]="chipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            [matChipInputAddOnBlur]="addOnBlur"
            (matChipInputTokenEnd)="add($event)"/>
        </mat-chip-list>
      </mat-form-field>

      <div class="button-row">
        <button type="submit" [disabled]="!formData.valid" mat-flat-button color="primary">
          <mat-icon>save</mat-icon>Add new Quicknote
        </button>
      </div>
    </form>
  </mat-card>

 <!-- Existing Notes -->
  <!-- #mytable is a template variable which we will use to refresh table data by calling -->
  <table mat-table [dataSource]="data" matSort matSortActive="summary" matSortDisableClear matSortDirection="asc"
         class="example-table">

    <ng-container matColumnDef="summary">
      <th mat-header-cell *matHeaderCellDef>Summary</th>
      <!-- color only works when selected is true -->
      <td mat-cell *matCellDef="let row">
        <mat-chip class="mat-chip-tag" color="primary" selected="true" class="mat-chip-tag" *ngFor="let tag of row.tags">{{tag}}</mat-chip>
        {{row.summary}}&nbsp;&nbsp;
      </td>
    </ng-container>

    <!--
    <ng-container matColumnDef="tags">
      <th mat-header-cell *matHeaderCellDef>Summary</th>
      <td mat-cell *matCellDef="let row">
      </td>
    </ng-container>
    -->

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let row">
        <mat-icon matTooltip="hase">{{getNoteStatus(row.status).icon}}</mat-icon>
      </td>
    </ng-container>

    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef>Created</th>
      <td mat-cell *matCellDef="let row">{{row.createdAt | amTimeAgo }}</td>
    </ng-container>

    <ng-container matColumnDef="dueDate">
      <th mat-header-cell *matHeaderCellDef>Due</th>
      <td mat-cell *matCellDef="let row">{{row.dueDate ? (row.dueDate | amTimeAgo) : 'never'}}</td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Action </th>
      <td mat-cell *matCellDef="let row;  let j = index;">
        <button *ngIf="authService.canDelete" color="warn" mat-icon-button (click)="deleteRow(row,j)">
          <mat-icon>delete_forever</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

</div>
