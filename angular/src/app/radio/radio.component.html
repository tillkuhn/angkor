<div class="app-flex">

  <mat-card class="app-card" style="max-width: 90%">
    <h3>
      <mat-icon svgIcon="song"></mat-icon>
      Welcome to Radio 91
    </h3>&nbsp;

    <mat-form-field appearance="outline">
    <input type="text" [formControl]="filterCtl" placeholder="Filter songs..." matInput>
    </mat-form-field>

    <!-- Result List -->
    <!-- https://stackoverflow.com/a/52750695/4292075 -->
    <mat-list *ngIf="(filteredSongs$ | async) as filteredSongs">

      <!-- the actual player -->
      <div class="media-player">
        <mat-toolbar class="rounded" color="primary">
          <mat-toolbar-row>
            {{ state?.readableCurrentTime }}
            <mat-slider class="time-slider" min="0" [max]="state?.duration" step="1" [value]="state?.currentTime"
                        (input)="onSliderChangeEnd($event)"
                        [disabled]="state?.error || currentSong.index === undefined"></mat-slider>
            {{ state?.readableDuration }}
          </mat-toolbar-row>

          <mat-toolbar-row class="media-action-bar">
            <!-- [disabled]="isFirstPlaying()"  -->
            <button mat-button (click)="previous()" [disabled]="currentSong.index === undefined||currentSong.index <=0">
              <mat-icon mat-list-icon>skip_previous</mat-icon>
            </button>

            <button mat-button (click)="play()" [disabled]="currentSong.index === undefined || state?.error" *ngIf="!state?.playing">
              <mat-icon mat-list-icon>play_circle_filled</mat-icon>
            </button>

            <button mat-button (click)="pause()" *ngIf="state?.playing">
              <mat-icon mat-list-icon>pause</mat-icon>
            </button>

            <button mat-button (click)="next()" [disabled]="currentSong.index === undefined||currentSong.index === filteredSongs.length -1">
              <mat-icon mat-list-icon>skip_next</mat-icon>
            </button>
          </mat-toolbar-row>
        </mat-toolbar>

      </div>

      <!-- summary <h3 mat-subheader>-->
      <div class="app-remark">
        <mat-icon inline="true" title="playing">equalizer</mat-icon>
        Found {{filteredSongs.length}} songs for the road,
        {{currentSong?.song ? 'playing #'+currentSong.index + ' ' + currentSong.song.tags['Title'] : 'no song selected'}}
      </div>

      <!-- list of matches -->
      <mat-list-item *ngFor="let song of filteredSongs; index as rowIndex; last as last"
                     (click)="openSong(filteredSongs, rowIndex)"
                     class="click-list">
        <!-- https://material.angular.io/components/list/overview#lists-with-avatars -->
        <!--<img matListAvatar alt="preview" [src]="previewImageUrl(item)"/> -->


        <!-- Main title, link will trigger open details dialog -->
        <h3 mat-line>
          <!-- <app-area-display *ngIf="item.areaCode" [areaCode]="item.areaCode" displaySize="md"></app-area-display> -->
          <!--<mat-icon [svgIcon]="item.entityType.toLowerCase()"></mat-icon>-->
          <!-- if router link is supported, link headline with it an stay within the app. we use external only styling -->
          <!--<a [routerLink]="[]" (click)="openDetailsDialog(item.id,item.entityType,rowIndex)" class="external">
            {{item.name}}
          </a>-->
          {{song.tags['Title'] ? song.tags['Title'] : ('⚠️ ' + song.path + ' (no title)')}}
          {{song.tags['Artist'] ? ( ' - ' + song.tags['Artist']) : '' }}
        </h3>

        <!-- mat-line is important, or p is appended -->
        <p mat-line>
          <mat-icon inline="true" title="Restricted Access">security</mat-icon>
          Restricted
          <mat-icon *ngIf="song.tags['Genre']" inline="true" title="Genre">speaker</mat-icon>
          {{song.tags['Genre']}}
          <mat-icon *ngIf="song.tags['Album']" inline="true" title="Album">folder</mat-icon>
          {{song.tags['Album']}}
        </p>
        <p *ngIf="song.presignedUrl" mat-line>
          <mat-icon inline="true">play</mat-icon>
          Play
          <a [href]="song.presignedUrl" target="_song" class="external">Play in New Tab</a>
        </p>

        <!-- divide is there are more items to come  -->
        <mat-divider *ngIf="!last" [inset]="true"></mat-divider>

      </mat-list-item>

    </mat-list>

  </mat-card>

</div>
